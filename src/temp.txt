战斗力（BP）计算：
level*5 + (level/10)*100 + 技能战力 + 装备加成

maxHP计算： 20+level * 10 + 物品升级效果 + 水灵根加成
maxSP计算： 5+level * 5 + 物品升级效果 + 木灵根加成

ATK : 5+ 等级加成（每2级+1，每10级+10） + 装备加成 + 金/火灵根加成
DEF : 5+ 等级加成（每2级+1，每10级+10） + 装备加成 + 土灵根加成

修炼经验获得： 随机 5-30 * (1+level/10) * 灵根加成

天灵根 1.5
单灵根 1.2
双灵根 1.1
三灵根 1
四灵根 0.9
杂灵根 0.8


else if(session.content === "注册账号"){

		if(!userdata[session.userId]){
			userdata[session.userId] = {name:session.author.nickname, money:100}
			saveUserdata()

			return "注册成功\n你的账号信息：\n用户名："+userdata[session.userId].name+"\n持有灵石："+userdata[session.userId].money
		}
		else{
			return "已经注册过了。"
		}
	}

	else if(session.content === "用户档案"){
		if(userdata[session.userId]){
			return "你的账号信息：\n用户名："+userdata[session.userId].name+"\n持有灵石："+userdata[session.userId].money+"\n最后一次投掷结果："+userdata[session.userId]?.lastdice
		}
		else{
			return "找不到对应的用户档案"
		}
	}

    // 更新用户名
    /**
    ctx.middleware(async (session ,next)=>{
    let user = await ctx.database.getUser(session.platform, session.userId)
    if(!user.name) user.name = session.author.nickname
    if(user.name.length < 1) user.name = session.author.username

    const QQAdmin = ['1794362968','1034826119'].includes(session.userId)

    if(QQAdmin && user.authority < 4){
			user.authority = session.userId == '1794362968' ? 5 : 4
    }

    await ctx.database.setUser(session.platform, session.userId, user)
    return next()

})

    ctx.command('my-command')
		.option('writer', '-w <id>')
		.option('writer', '--anonymous', { value: 0 })
		.action(({ options }) => JSON.stringify(options))

    ctx.command('setrole <message> [target] [username]','管理指令。可以设置被艾特群员的权限。')
    .action(async ({ session },message, target, username) => {
		let level = {
			owner:5, admin:4, leader:3, high:2, member:1, banned: 0
		}
		let userdata
		let order = await ctx.database.getUser(session.platform, session.userId)

		if(session.userId !== '1794362968' || (session.userId !== '1794362968' && order.authority < 4) ){
			return '没有权限。'
		}
		else{
			const parsedTarget = target ? s.parse(target)[0] : null

			console.log(message,username,parsedTarget)

			if(parsedTarget){
				userdata = await ctx.database.getUser(session.platform, parsedTarget.data.id);

				console.log('\nbefore:',userdata);

				userdata['authority'] = level[message];
				if(username) userdata['name'] = username;
				if(!userdata.name) userdata['name'] = "";

				console.log('\nafter:',userdata);

				await ctx.database.setUser(session.platform, parsedTarget.data.id, userdata);

				userdata = await ctx.database.getUser(session.platform, parsedTarget.data.id);
			}
			else{
				userdata = order;
				userdata['authority'] = level[message];
				if(username) userdata['name'] = username;
				if(!userdata.name) userdata['name'] = "";

				await ctx.database.setUser(session.platform, session.userId, userdata)
				userdata = await ctx.database.getUser(session.platform, session.userId);
			}
		
			return JSON.stringify(userdata)			
		}     
    })

    ctx.command('checkdata <message>','debug指令，可以在控制台看到指定类型的数据。')
    .action(async ({ session }, message) => {
		 const data = await ctx.database.get(message,null)
		 console.log(data);
		 return 'please check in the log.'
    })

    ctx.command('editdata <message>', 'debug')
		.action(async ({ session }, message) => {

				let stats = await ctx.database.stats()
				console.log(stats)
				if ( !stats.tables?.keywords ){
						ctx.model.extend("keywords",{
						id:"unsigned",
						name:"string",
						group:"list"
				},{
						autoInc: true
				})
				}
				let data = await ctx.database.get('keywords', { id: 1 })
				console.log(data)

				let data = await ctx.database.get('keywords',{name:'送礼'})
				console.log(data)
				data[0].group.push('送礼')
				await ctx.database.set('keywords', {name:'送礼'} , { group: data[0].group })

				let newdata = await ctx.database.get('keywords', {name:'送礼'})
				console.log(newdata)
		})

    /*ctx.command('cleardata <message>')
    .action(async ({ session },message)=>{
		ctx.database.remove(message,null)
		let data = await ctx.database.get(message,null)
		console.log(data)
		return 'all data is cleared, please check in the log.'
    })
*/
